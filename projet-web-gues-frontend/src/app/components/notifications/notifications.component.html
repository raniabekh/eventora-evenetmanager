<!-- src/app/components/notifications/notifications.component.html -->
<div class="notifications-container">

  <!-- EN-T√äTE -->
  <header class="notifications-header">
    <div class="header-content">
      <h1 class="page-title">
        <span class="title-icon">üîî</span>
        Notifications
      </h1>
      <p class="page-subtitle">Restez inform√© de toutes vos activit√©s</p>

      <!-- STATISTIQUES -->
      <div class="stats-cards" *ngIf="!isLoading && !hasError">
        <div class="stat-card total">
          <span class="stat-number">{{ stats.total }}</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat-card unread">
          <span class="stat-number">{{ stats.unread }}</span>
          <span class="stat-label">Non lues</span>
        </div>
        <div class="stat-card read">
          <span class="stat-number">{{ stats.read }}</span>
          <span class="stat-label">Lues</span>
        </div>
      </div>
    </div>
  </header>

  <!-- FILTRES ET ACTIONS -->
  <section class="controls-section">
    <div class="controls-card">
      <!-- RECHERCHE -->
      <div class="search-container">
        <div class="search-input-group">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="applyFilters()"
            placeholder="Rechercher dans les notifications..."
            class="search-input"
          />
          <button *ngIf="searchTerm" (click)="searchTerm = ''; applyFilters()" class="clear-search">
            ‚úï
          </button>
        </div>
      </div>

      <!-- FILTRES -->
      <div class="filters-row">
        <!-- FILTRE TYPE -->
        <div class="filter-group">
          <label class="filter-label">Type</label>
          <select [(ngModel)]="filterType" (change)="applyFilters()" class="filter-select">
            <option *ngFor="let type of notificationTypes" [value]="type.value">
              {{ type.icon }} {{ type.label }}
            </option>
          </select>
        </div>

        <!-- FILTRE NON LUES -->
        <div class="filter-group checkbox-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="filterUnreadOnly"
              (change)="applyFilters()"
              class="checkbox-input"
            />
            <span class="checkbox-custom"></span>
            <span class="checkbox-text">Afficher uniquement les non lues</span>
          </label>
        </div>

        <!-- ACTIONS -->
        <div class="actions-group">
          <button (click)="markAllAsRead()" class="btn-action" [disabled]="stats.unread === 0">
            <span class="btn-icon">‚úÖ</span>
            Tout marquer comme lu
          </button>
          <button (click)="deleteAllRead()" class="btn-action btn-danger" [disabled]="stats.read === 0">
            <span class="btn-icon">üóëÔ∏è</span>
            Supprimer les lues
          </button>
          <button (click)="clearAll()" class="btn-action btn-danger" [disabled]="stats.total === 0">
            <span class="btn-icon">üöÆ</span>
            Tout supprimer
          </button>
        </div>
      </div>

      <!-- BADGES FILTRES ACTIFS -->
      <div class="active-filters" *ngIf="filterType !== 'all' || filterUnreadOnly || searchTerm">
        <span class="filters-label">Filtres actifs :</span>

        <span class="filter-badge" *ngIf="filterType !== 'all'">
          {{ getTypeIcon(filterType) }} {{ getTypeLabel(filterType) }}
          <button (click)="filterType = 'all'; applyFilters()">√ó</button>
        </span>

        <span class="filter-badge" *ngIf="filterUnreadOnly">
          üëÅÔ∏è Non lues seulement
          <button (click)="filterUnreadOnly = false; applyFilters()">√ó</button>
        </span>

        <span class="filter-badge" *ngIf="searchTerm">
          üîç "{{ searchTerm }}"
          <button (click)="searchTerm = ''; applyFilters()">√ó</button>
        </span>

        <button (click)="filterType = 'all'; filterUnreadOnly = false; searchTerm = ''; applyFilters()"
                class="clear-all-filters">
          Effacer tous les filtres
        </button>
      </div>
    </div>
  </section>

  <!-- CONTENU PRINCIPAL -->
  <main class="main-content">
    <!-- CHARGEMENT -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>Chargement des notifications...</p>
    </div>

    <!-- ERREUR -->
    <div *ngIf="hasError && !isLoading" class="error-state">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h3>Erreur de chargement</h3>
      <p>Impossible de charger les notifications. Veuillez r√©essayer.</p>
      <button (click)="loadNotifications()" class="btn-retry">‚Üª R√©essayer</button>
    </div>

    <!-- AUCUNE NOTIFICATION -->
    <div *ngIf="!isLoading && !hasError && notifications.length === 0" class="empty-state">
      <div class="empty-icon">üì≠</div>
      <h3>Aucune notification</h3>
      <p>Vous n'avez pas encore de notifications. Revenez plus tard !</p>
    </div>

    <!-- AUCUNE NOTIFICATION AVEC FILTRES -->
    <div *ngIf="!isLoading && !hasError && notifications.length > 0 && filteredNotifications.length === 0"
         class="empty-state">
      <div class="empty-icon">üîç</div>
      <h3>Aucun r√©sultat</h3>
      <p>Aucune notification ne correspond √† vos crit√®res de recherche.</p>
      <button (click)="filterType = 'all'; filterUnreadOnly = false; searchTerm = ''; applyFilters()"
              class="btn-retry">
        Afficher toutes les notifications
      </button>
    </div>

    <!-- LISTE DES NOTIFICATIONS -->
    <section *ngIf="!isLoading && !hasError && filteredNotifications.length > 0" class="notifications-list">
      <div class="list-header">
        <h2>
          {{ filteredNotifications.length }} notification{{ filteredNotifications.length > 1 ? 's' : '' }}
          <span *ngIf="filterType !== 'all' || filterUnreadOnly || searchTerm">filtr√©e{{ filteredNotifications.length > 1 ? 's' : '' }}</span>
        </h2>

        <!-- PAGINATION HEADER -->
        <div class="pagination-info" *ngIf="totalPages > 1">
          Page {{ currentPage }} sur {{ totalPages }}
        </div>
      </div>

      <!-- LISTE -->
      <div class="notifications-grid">
        <div *ngFor="let notification of paginatedNotifications"
             class="notification-card"
             [class.unread]="!notification.read"
             [class.read]="notification.read"
             (click)="navigateToAction(notification, $event)">

          <!-- INDICATEUR NON LU -->
          <div *ngIf="!notification.read" class="unread-indicator"></div>

          <!-- EN-T√äTE -->
          <div class="notification-header">
            <!-- IC√îNE TYPE -->
            <div class="type-icon" [style.background]="getTypeColor(notification.type)">
              {{ getTypeIcon(notification.type) }}
            </div>

            <!-- TITRE ET DATE -->
            <div class="header-content">
              <h3 class="notification-title">{{ notification.title }}</h3>
              <div class="notification-meta">
                <span class="notification-type" [style.color]="getTypeColor(notification.type)">
                  {{ getTypeLabel(notification.type) }}
                </span>
                <span class="notification-date">‚Ä¢ {{ formatDate(notification.createdAt) }}</span>
              </div>
            </div>

            <!-- ACTIONS -->
            <div class="notification-actions">
              <button
                *ngIf="!notification.read"
                (click)="markAsRead(notification, $event)"
                class="btn-mark-read"
                title="Marquer comme lu"
              >
                üëÅÔ∏è
              </button>
              <button
                (click)="deleteNotification(notification, $event)"
                class="btn-delete"
                title="Supprimer"
              >
                üóëÔ∏è
              </button>
            </div>
          </div>

          <!-- MESSAGE -->
          <div class="notification-body">
            <p class="notification-message">{{ notification.message }}</p>

            <!-- DONN√âES SUPPL√âMENTAIRES -->
            <div *ngIf="notification.data" class="notification-data">
              <small>Donn√©es : {{ notification.data | json }}</small>
            </div>
          </div>

          <!-- ACTION -->
          <div *ngIf="notification.actionUrl" class="notification-footer">
            <button (click)="navigateToAction(notification, $event)" class="btn-action">
              <span class="btn-icon">‚Üí</span>
              Voir les d√©tails
            </button>
          </div>

          <!-- PRIORIT√â -->
          <div *ngIf="notification.priority === 'high'" class="priority-badge high">
            ‚ö†Ô∏è Haute priorit√©
          </div>
          <div *ngIf="notification.priority === 'medium'" class="priority-badge medium">
            üìå Priorit√© moyenne
          </div>
        </div>
      </div>

      <!-- PAGINATION -->
      <div *ngIf="totalPages > 1" class="pagination">
        <button
          (click)="prevPage()"
          [disabled]="currentPage === 1"
          class="pagination-btn prev"
        >
          ‚Üê Pr√©c√©dent
        </button>

        <div class="page-numbers">
          <button
            *ngFor="let page of pageNumbers"
            (click)="goToPage(page)"
            [class.active]="page === currentPage"
            class="page-btn"
          >
            {{ page }}
          </button>
        </div>

        <button
          (click)="nextPage()"
          [disabled]="currentPage === totalPages"
          class="pagination-btn next"
        >
          Suivant ‚Üí
        </button>
      </div>

      <!-- INFO PAGINATION -->
      <div class="pagination-info-bottom" *ngIf="filteredNotifications.length > 0">
        Affichage de {{ paginatedNotifications.length }} notification{{ paginatedNotifications.length > 1 ? 's' : '' }}
        sur {{ filteredNotifications.length }}
      </div>
    </section>
  </main>
</div>
